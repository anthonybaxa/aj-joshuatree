<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Joshua Tree At-a-Glance Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Sandstone -->
    <!-- Application Structure Plan: A single-page dashboard with a sticky navigation bar for filtering. The itinerary builder is now "smart," automatically opening when it scrolls into view with items, and is supported by a dedicated sticky header that appears on scroll, providing constant context and a clear call-to-action to return to the top. This solves previous UI clashes while enhancing usability. -->
    <!-- Visualization & Content Choices: The guide's text-based content is presented using structured HTML. The primary interactions are JavaScript-powered filters and a drag-and-drop itinerary system. The two sticky headers and the auto-open feature are managed by a combination of a scroll event listener and an IntersectionObserver, creating a robust and intelligent UI. CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #FDF6E3; /* Warm Sandstone base */
            color: #586e75;
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, .font-display {
            font-family: 'Poppins', sans-serif;
        }
        .nav-btn {
            transition: all 0.3s ease;
        }
        .nav-btn:hover {
            transform: scale(1.05);
        }
        .nav-btn.active {
            background-color: #E67E22; /* Richer Orange */
            color: #FFFFFF;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .add-btn {
            transition: all 0.2s ease-out;
        }
        .add-btn:active {
            transform: scale(0.95);
        }
        .location-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: #ffffff;
            border: 1px solid #EEE8D5;
        }
        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
        }
        .pro-tips {
            background-color: #EEE8D5;
        }
        .insider-tip {
            background-color: #FBF1C7;
        }
        .itinerary-item {
            cursor: grab;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            background: linear-gradient(to right, #f8fafc, #f1f5f9);
            border: 1px solid #e2e8f0;
        }
        .itinerary-item:hover {
             transform: scale(1.02);
             box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .itinerary-item:active {
            cursor: grabbing;
        }
        .dragging, .touch-dragging {
            opacity: 0.7;
            background: #fefce8;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #itinerary-content {
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
        }
        #itinerary-content.open {
            max-height: 1500px; /* Increased max-height */
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }
        #sticky-itinerary-bar {
            transition: transform 0.3s ease-in-out;
        }
        #navigation {
            transition: top 0.3s ease-in-out;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="antialiased">
    
    <div id="sticky-itinerary-bar" class="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md shadow-lg p-3 z-30 transform -translate-y-full cursor-pointer">
        <div class="container mx-auto flex justify-center items-center">
            <p id="sticky-itinerary-text" class="font-bold text-gray-800 text-center text-sm sm:text-base"></p>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8 md:mb-10">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-800 mb-2 tracking-tighter">üåµ AJ's Joshua Tree Guide üåµ</h1>
            <p class="text-base sm:text-lg text-gray-600 max-w-3xl mx-auto">
                Your ultimate companion for an unforgettable desert adventure! This guide focuses on the most unique and exciting experiences that don't require hiking boots‚Äîfrom quirky art to incredible scenic drives.
            </p>
        </header>

        <!-- NEW: Offline Use Reminder -->
        <section class="mb-8 md:mb-10 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-r-lg" role="alert">
            <p class="font-bold">Pro-Tip for the Road</p>
            <p>Cell service in Joshua Tree is unreliable. Use your browser's "Add to Home Screen" or "Download page" feature now to save this guide for offline use!</p>
        </section>

        <section id="itinerary-builder" class="mb-8 md:mb-10 bg-white rounded-2xl shadow-md border border-gray-200">
            <button id="toggle-itinerary" class="w-full text-left p-4 rounded-t-2xl font-display font-bold text-xl text-gray-800 flex justify-between items-center bg-gray-50 hover:bg-gray-100 transition-colors">
                <span>üìÖ My Itinerary</span>
                <span id="itinerary-arrow" class="transform transition-transform">‚ñº</span>
            </button>
            <div id="itinerary-content" class="px-6 border-t">
                <div id="itinerary-list" class="space-y-3">
                    <p id="itinerary-placeholder" class="text-gray-500 text-center py-4">Your itinerary is empty. Click "Add to Itinerary" on any location to start planning your trip!</p>
                </div>
                <div class="mt-4 pt-4 border-t-2 border-dashed">
                    <button id="copy-itinerary-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed font-display">Copy Itinerary to Clipboard</button>
                    <p id="copy-confirmation" class="text-center text-green-700 font-semibold mt-2 opacity-0 transition-opacity">Copied!</p>
                </div>
            </div>
        </section>

        <section class="pro-tips p-6 rounded-2xl mb-8 md:mb-10 shadow-md">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">‚ú® Pro-Tips for Your Adventure ‚ú®</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-gray-700">
                <div class="flex items-start gap-3">
                    <span class="text-xl mt-1">üíß</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Hydration is Key</h3>
                        <p>The golden rule is <strong>one gallon of water per person, per day.</strong> Pack salty snacks to stay energized.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-xl mt-1">üì±</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Be Your Own Tour Guide</h3>
                        <p>Before you lose service, download the official <strong>NPS App</strong> for its fantastic self-guided audio tour.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                     <span class="text-xl mt-1">‚≠ê</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Plan for Peak Starlight</h3>
                        <p>Joshua Tree is a world-class Dark Sky Park. Check an astronomy app for the moon phase‚Äîa new moon means breathtaking views of the Milky Way.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                     <span class="text-xl mt-1">üëï</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Dress for Success</h3>
                        <p>Wear lightweight, long-sleeved shirts, a wide-brimmed hat, and sunglasses. Pack layers for surprisingly cool nights.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-3">
                     <span class="text-xl mt-1">üì°</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Plan for Zero Service</h3>
                        <p>Download maps and this guide offline. Leave a detailed itinerary with someone back home.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                     <span class="text-xl mt-1">ü§†</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Chat with a Ranger</h3>
                        <p>Check visitor center bulletin boards for free "Ranger Talks" for amazing insights.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-xl mt-1">‚õΩ</span>
                   <div>
                       <h3 class="font-bold text-gray-800 font-display">Start with a Full Tank</h3>
                       <p>Gas stations are sparse. For any trip over 30 mins, make sure your tank is full before you venture out.</p>
                   </div>
               </div>
               <div class="flex items-start gap-3">
                <span class="text-xl mt-1">ü•™</span>
               <div>
                   <h3 class="font-bold text-gray-800 font-display">Pack a Cooler</h3>
                   <p>For longer day trips, bring a cooler with lunch and drinks. You can't always count on finding a place to eat in remote areas.</p>
               </div>
           </div>
                 <div class="flex items-start gap-3 md:col-span-2">
                     <span class="text-xl mt-1">üêæ</span>
                    <div>
                        <h3 class="font-bold text-gray-800 font-display">Watch for Your Neighbors</h3>
                        <p>Your hub is where town meets wild. Expect wildlife like coyotes at dawn and dusk. Keep a respectful distance and never leave food outside.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- NEW: Search Bar -->
        <div class="mb-4">
             <input type="search" id="search-bar" placeholder="üîé Search for a specific location..." class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow">
        </div>

        <nav id="navigation" class="sticky top-4 z-20 bg-white/70 backdrop-blur-md p-3 sm:p-4 rounded-2xl shadow-lg mb-8 md:mb-10">
            <div class="flex flex-nowrap md:flex-wrap justify-start md:justify-center items-center gap-2 overflow-x-auto no-scrollbar">
                <button class="nav-btn active px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="all">All Locations</button>
                <button class="nav-btn px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="Art & Culture">üé® Art & Culture</button>
                <button class="nav-btn px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="Dining & Shopping">üõçÔ∏è Dining & Shopping</button>
                <button class="nav-btn px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="Scenic & Nature">üåÑ Scenic & Nature</button>
                <button class="nav-btn px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="History & Landmarks">üèõÔ∏è History & Landmarks</button>
                <button class="nav-btn px-4 py-2 rounded-full font-semibold text-sm flex-shrink-0" data-filter="Unique Experiences">‚ú® Unique Experiences</button>
            </div>
        </nav>
        
        <main id="locations-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
            <!-- Location cards will be dynamically inserted here -->
        </main>
    </div>

    <script>
        // UPDATED: locationsData with `isEveningOuting` property
        const locationsData = [
            {
                id: "beauty-bubble-salon",
                name: "Beauty Bubble Salon & Museum",
                tags: ["Dining & Shopping", "Unique Experiences"],
                travelTime: "~5 mins",
                direction: "W",
                whatItIs: "A fabulously kitschy spot that's a working salon <em>and</em> a museum packed with 3,000+ pieces of vintage beauty gear.",
                perfectFor: "Lovers of pop culture, retro style, and wonderfully weird photo ops.",
                knowBeforeYouGo: "Open Tue-Sat 10am-6pm | Free to browse.",
                insiderTip: "Even if you‚Äôre not getting a beehive hairdo, pop in! The owner is famously friendly and loves to share the hilarious stories behind his collection.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "crochet-museum",
                name: "World Famous Crochet Museum",
                tags: ["Art & Culture", "Unique Experiences"],
                travelTime: "~5 mins",
                direction: "W",
                whatItIs: "A tiny, acid-green photo booth transformed into a wonderfully bizarre museum dedicated to all things crochet.",
                perfectFor: "A quick, hilarious, and supremely quirky photo op.",
                knowBeforeYouGo: "Always open to peek into! | Free.",
                insiderTip: "The museum is part of the 'Art Queen' complex, so explore the other quirky art installations on the same lot.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: true,
                isEveningOuting: false
            },
            {
                id: "joshua-tree-coffee",
                name: "Joshua Tree Coffee Company",
                tags: ["Dining & Shopping"],
                travelTime: "~5 mins",
                direction: "W",
                whatItIs: "The legendary local spot for amazing, small-batch organic coffee. The line is a testament to how good it is!",
                perfectFor: "The perfect morning kickstart.",
                knowBeforeYouGo: "Open daily, morning/afternoon hours.",
                insiderTip: "The line moves fast and is totally worth it. Grab a bag of their whole beans to take the taste of Joshua Tree home with you.",
                cost: "$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "joshua-tree-saloon",
                name: "Joshua Tree Saloon",
                tags: ["Dining & Shopping"],
                travelTime: "~5 mins",
                direction: "W",
                whatItIs: "The perfect post-adventure refuel spot! A classic Old West saloon serving up hearty burgers and cold beer.",
                perfectFor: "A fun, casual meal with a classic desert vibe.",
                knowBeforeYouGo: "Open daily, late hours | Mid-range.",
                insiderTip: "You can't go wrong with the Mineshaft Burger and a pint of their own Prickly Pear Blond Ale!",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: true
            },
            {
                id: "hoof-and-horn",
                name: "Hoof & The Horn",
                tags: ["Dining & Shopping"],
                travelTime: "~5 mins",
                direction: "W",
                whatItIs: "A beautifully curated boutique that perfectly captures the modern desert-boho aesthetic.",
                perfectFor: "Finding that perfect, stylish souvenir or a unique piece of desert-inspired fashion.",
                knowBeforeYouGo: "Open daily.",
                insiderTip: "A great place to find high-quality, locally designed t-shirts that go way beyond typical tourist gear.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "noah-purifoy-museum",
                name: "Noah Purifoy Outdoor Desert Art Museum",
                tags: ["Art & Culture"],
                travelTime: "~10 mins",
                direction: "N",
                whatItIs: "A sprawling 10-acre wonderland of thought-provoking sculptures built entirely from junk and found objects.",
                perfectFor: "Art lovers and curious explorers.",
                knowBeforeYouGo: "Open Daily, sunrise to sunset | Free (donations welcome!). Always watch where you step.",
                insiderTip: "Don't look for explanation signs. The artist wanted you to have your <em>own</em> unique reaction to his incredible work.",
                cost: "Free",
                isTopPick: true,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "hi-desert-nature-museum",
                name: "Hi-Desert Nature Museum",
                tags: ["Art & Culture", "History & Landmarks"],
                travelTime: "~15 mins",
                direction: "W",
                whatItIs: "A super fun crash course in the desert's secrets! Unlock the mysteries of the quirky plants, cool animals, and unique geology that make this place so special.",
                perfectFor: "Families & curious minds.",
                knowBeforeYouGo: "Open Wed-Sat 10am-5pm | Free!",
                insiderTip: "Pair it with a treasure hunt through the antique shops in Old Town Yucca Valley for a perfect afternoon two-fer!",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "desert-christ-park",
                name: "Desert Christ Park",
                tags: ["Art & Culture", "Unique Experiences"],
                travelTime: "~15 mins",
                direction: "W",
                whatItIs: "A unique park overlooking Yucca Valley, featuring over 40 large, snow-white sculptures depicting scenes from the life of Christ.",
                perfectFor: "Those who love roadside attractions, folk art, and unique cultural landmarks.",
                knowBeforeYouGo: "Open daily, sunrise to sunset | Free (donations welcome).",
                insiderTip: "Visit in the late afternoon when the low sun creates dramatic shadows on the sculptures.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "the-copper-room",
                name: "The Copper Room",
                tags: ["Dining & Shopping"],
                travelTime: "~15 mins",
                direction: "W",
                whatItIs: "A trip back in time! A restored 1950s lounge with swanky cocktails and a prime view overlooking the Yucca Valley Airport runway.",
                perfectFor: "A historic, retro-themed dinner with a cinematic twist.",
                knowBeforeYouGo: "Open Daily 4pm-10pm | Reservations highly recommended.",
                insiderTip: "Request a runway view when booking to watch small planes take off against a dramatic desert sunset.",
                cost: "$$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: true
            },
            {
                id: "rainbow-stew",
                name: "Rainbow Stew",
                tags: ["Dining & Shopping"],
                travelTime: "~15 mins",
                direction: "W",
                whatItIs: "The epicenter of the 'Hi-Desert' vibe. A magical shop filled with crystals, sage, and a huge collection of local art.",
                perfectFor: "Finding unique, spiritual gifts and soaking in the local culture.",
                knowBeforeYouGo: "Open Daily (hours vary).",
                insiderTip: "Ask the staff about the local artists. Their stories add a personal connection to every piece.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "the-end-vintage",
                name: "The End",
                tags: ["Dining & Shopping"],
                travelTime: "~15 mins",
                direction: "W",
                whatItIs: "A legendary vintage store known for its amazing, curated collection of retro clothing and accessories.",
                perfectFor: "Treasure hunters looking for unique, one-of-a-kind vintage finds.",
                knowBeforeYouGo: "Open 7 days a week from 11am to 5pm.",
                insiderTip: "Give yourself plenty of time to dig! The racks are packed with amazing pieces waiting to be discovered.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "skys-the-limit",
                name: "Sky's The Limit Observatory",
                tags: ["Unique Experiences", "Scenic & Nature"],
                travelTime: "~15 mins",
                direction: "E",
                whatItIs: "Your personal journey through the cosmos! Peer through powerful telescopes to see distant galaxies and sparkling star clusters.",
                perfectFor: "A comfy, mind-blowing stargazing adventure for all.",
                knowBeforeYouGo: "Grounds always open | Monthly star parties require tickets. Wear closed-toed shoes at night.",
                insiderTip: "Visit during the day and use the QR codes on-site for a fun, self-guided audio tour of the walkable solar system model!",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: true
            },
            {
                id: "jt-visitor-center",
                name: "Joshua Tree Visitor & Cultural Center",
                tags: ["Art & Culture", "History & Landmarks"],
                travelTime: "~20 mins",
                direction: "E",
                whatItIs: "Mission control for your adventure! This is your essential first stop, featuring a fantastic museum that honors the region's Native American history.",
                perfectFor: "Literally everyone.",
                knowBeforeYouGo: "Open Daily 8am-5pm | Free! Last stop for reliable water/restrooms before the north park entrance.",
                insiderTip: "Spend an hour in the museum <em>before</em> you enter the park. The context it provides will completely change how you see the landscape.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "29-palms-art-gallery",
                name: "29 Palms Art Gallery",
                tags: ["Art & Culture"],
                travelTime: "~20 mins",
                direction: "E",
                whatItIs: "Step into the heart of the desert's art scene! The oldest gallery in the area, housed in a charming, historic adobe building.",
                perfectFor: "Art lovers and history buffs.",
                knowBeforeYouGo: "Open Fri-Sun 11am-3pm | Free!",
                insiderTip: "Check their schedule for a monthly artist reception. It's a fantastic chance to mingle with local creatives.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "29-palms-creative-center",
                name: "29 Palms Creative Center",
                tags: ["Art & Culture", "Unique Experiences"],
                travelTime: "~20 mins",
                direction: "E",
                whatItIs: "Unleash your inner artist! Offers fun, one-off classes like pottery and painting in a cool, air-conditioned studio.",
                perfectFor: "A unique, hands-on souvenir-making session.",
                knowBeforeYouGo: "By appointment only | Costs vary ($45+).",
                insiderTip: "For a memorable group activity, book a private 'Neon Black Light Painting Party'!",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "29-palms-inn",
                name: "29 Palms Inn",
                tags: ["Dining & Shopping"],
                travelTime: "~20 mins",
                direction: "E",
                whatItIs: "Dinner in a literal oasis. This historic inn offers an upscale meal in a lush, romantic garden, often with live music.",
                perfectFor: "A romantic dinner or a special occasion.",
                knowBeforeYouGo: "Open Wed-Sun for dinner | Reservations highly recommended.",
                insiderTip: "Arrive before sunset to wander the beautiful grounds and the adjacent Oasis of Mara.",
                cost: "$$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: true
            },
            {
                id: "oasis-of-murals",
                name: "Oasis of Murals (Self-Guided Tour)",
                tags: ["Art & Culture"],
                travelTime: "~20 mins",
                direction: "E",
                whatItIs: "An art safari in your car! Hunt for over 26 massive murals that tell the story of the region's history.",
                perfectFor: "A flexible driving tour on a hot or windy day.",
                knowBeforeYouGo: "Viewable anytime | Free.",
                insiderTip: "Grab a physical map from the Visitor Center for the fascinating history behind each mural.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "big-morongo-canyon",
                name: "Big Morongo Canyon Preserve",
                tags: ["Scenic & Nature"],
                travelTime: "~20 mins",
                direction: "W",
                whatItIs: "A lush, green oasis that's a world away from the desert. A bird-watching paradise with accessible, shaded boardwalk trails.",
                perfectFor: "A relaxing, cool, and easy nature walk, especially on a warm day.",
                knowBeforeYouGo: "Open daily, 7:30 am to sunset | Free (donations appreciated).",
                insiderTip: "Bring binoculars! This is one of the best birding spots in California.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: true,
                isEveningOuting: false
            },
            {
                id: "skull-rock",
                name: "Skull Rock",
                tags: ["Scenic & Nature"],
                travelTime: "~20 mins",
                direction: "S",
                whatItIs: "The park's most famous rock star! Wind and rain have carved this boulder into an uncanny resemblance of a human skull.",
                perfectFor: "A quick, classic photo op that's a must-do.",
                knowBeforeYouGo: "Located right off Park Boulevard | Park entrance fee required.",
                insiderTip: "Parking is tight. If full, park at Jumbo Rocks Campground and take a very short walk.",
                cost: "$",
                isTopPick: true,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "horseback-riding",
                name: "Horseback Riding",
                tags: ["Unique Experiences"],
                travelTime: "~20 mins",
                direction: "W",
                whatItIs: "Saddle up, partner! See the Mojave Desert like a real cowboy on a guided tour.",
                perfectFor: "A memorable adventure for all skill levels.",
                knowBeforeYouGo: "Local ranches offer guided tours. Book in advance.",
                insiderTip: "A sunset ride is an absolutely magical experience, offering incredible views and photo opportunities.",
                cost: "$$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "integratron",
                name: "The Integratron",
                tags: ["Unique Experiences"],
                travelTime: "~25 mins",
                direction: "NW",
                whatItIs: "An experience you'll talk about forever. Relax in a world-famous, acoustically perfect dome for an unforgettable 'Sound Bath.'",
                perfectFor: "Anyone seeking deep relaxation or a truly unique experience.",
                knowBeforeYouGo: "Open Thu-Sun | ~$55/person | <strong>Reservations are essential and sell out MONTHS in advance.</strong>",
                insiderTip: "Can't get a ticket? You can often still visit the grounds to see the incredible structure from the outside.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "mazamar-pottery",
                name: "MazAmar Art Pottery",
                tags: ["Dining & Shopping", "Art & Culture"],
                travelTime: "~25 mins",
                direction: "NW",
                whatItIs: "A working pottery studio on Pioneertown's iconic Mane Street, famous for their 'Joshua Tree Mugs'.",
                perfectFor: "Taking a fun, accessible pottery class in a truly unique Old West setting.",
                knowBeforeYouGo: "Studio store open daily | Classes must be scheduled in advance.",
                insiderTip: "Book a class well in advance, especially for a weekend, then browse the gallery.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "la-copine",
                name: "La Copine Kitchen",
                tags: ["Dining & Shopping"],
                travelTime: "~25 mins",
                direction: "NW",
                whatItIs: "A culinary pilgrimage! This nationally acclaimed restaurant serves an inventive menu that's 100% worth the drive.",
                perfectFor: "Foodies looking for an unforgettable meal.",
                knowBeforeYouGo: "Open Thu-Sun 11am-4pm | No reservations.",
                insiderTip: "To minimize the wait, go on a Thursday or arrive right when they open.",
                cost: "$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "pappy-and-harriets",
                name: "Pappy & Harriet's Pioneertown Palace",
                tags: ["Dining & Shopping", "Unique Experiences"],
                travelTime: "~25 mins",
                direction: "NW",
                whatItIs: "One of the most famous desert venues in the world. A legendary BBQ joint and live music spot.",
                perfectFor: "A rowdy, fun night of great food, live music, and authentic desert culture.",
                knowBeforeYouGo: "Open Thu-Sun | Dinner reservations and advance music tickets are essential.",
                insiderTip: "Even without show tickets, you can often grab a drink at the bar and soak in the historic atmosphere.",
                cost: "$$",
                isTopPick: true,
                isHiddenGem: false,
                isEveningOuting: true
            },
            {
                id: "pioneertown",
                name: "Pioneertown",
                tags: ["History & Landmarks", "Unique Experiences"],
                travelTime: "~25 mins",
                direction: "NW",
                whatItIs: "A real 1880s Old West movie set you can walk through, featuring classic storefronts and fun shops.",
                perfectFor: "History buffs, film lovers, and music fans.",
                knowBeforeYouGo: "Mane Street is always open | Free to visit.",
                insiderTip: "Visit on a weekend for the liveliest atmosphere and a possible Wild West show!",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "glass-outhouse",
                name: "The Glass Outhouse Art Gallery",
                tags: ["Art & Culture", "Unique Experiences"],
                travelTime: "~30 mins",
                direction: "E",
                whatItIs: "A whimsical outdoor playground of surreal, humorous folk art, complete with a functional outhouse made of one-way mirrors.",
                perfectFor: "Anyone who loves quirky art and fantastic photo ops.",
                knowBeforeYouGo: "Outdoor art is always accessible | Free.",
                insiderTip: "If you see the owner, say hello! She has fascinating stories about creating this beloved local landmark.",
                cost: "Free",
                isTopPick: false,
                isHiddenGem: true,
                isEveningOuting: false
            },
            {
                id: "keys-view",
                name: "Keys View",
                tags: ["Scenic & Nature"],
                travelTime: "~40 mins",
                direction: "S",
                whatItIs: "The ultimate panorama! Drive up for a breathtaking view of the entire Coachella Valley and the San Andreas Fault.",
                perfectFor: "Everyone. The paved loop makes this incredible view accessible to all.",
                knowBeforeYouGo: "Open 24/7 (road permitting) | Park entrance fee required.",
                insiderTip: "It's <em>always</em> colder and windier up here. Bring an extra layer, even on a warm day.",
                cost: "$",
                isTopPick: true,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "cabots-pueblo",
                name: "Cabot's Pueblo Museum",
                tags: ["Art & Culture", "History & Landmarks"],
                travelTime: "~45 mins",
                direction: "SW",
                whatItIs: "A jaw-dropping masterpiece of ingenuity! Explore a massive, multi-level pueblo hand-built by a local pioneer from reclaimed materials.",
                perfectFor: "Anyone who loves unique architecture and incredible stories.",
                knowBeforeYouGo: "Open Tue-Sat 9am-1pm | ~$13 admission.",
                insiderTip: "<strong>Absolutely take the guided tour.</strong> The docents tell wild stories about the founder's adventurous life that you won't get anywhere else.",
                cost: "$",
                isTopPick: false,
                isHiddenGem: true,
                isEveningOuting: false
            },
            {
                id: "cholla-cactus-garden",
                name: "Cholla Cactus Garden",
                tags: ["Scenic & Nature"],
                travelTime: "~45 mins",
                direction: "SE",
                whatItIs: "A beautiful and slightly dangerous cactus forest! Filled with 'teddy bear cholla,' but be warned‚Äîtheir spines detach easily.",
                perfectFor: "Photographers and thrill-seekers. <strong>WARNING: DO NOT TOUCH THE CACTI.</strong>",
                knowBeforeYouGo: "Open 24/7 | Park entrance fee required. Wear closed-toed shoes.",
                insiderTip: "<strong>Go at sunrise or sunset.</strong> The low-angle light makes the cactus spines glow as if they're lit from within.",
                cost: "$",
                isTopPick: true,
                isHiddenGem: false,
                isEveningOuting: false
            },
            {
                id: "offroading",
                name: "Offroading Adventure",
                tags: ["Unique Experiences"],
                travelTime: "Varies",
                direction: "",
                whatItIs: "Explore the park's rugged backcountry on wheels! A 4x4 adventure lets you discover remote dirt roads.",
                perfectFor: "Adventure seekers who want to get off the beaten path.",
                knowBeforeYouGo: "Many dirt roads are open to 4-wheel drive vehicles. Tours are available.",
                insiderTip: "Before you go, make sure your vehicle's tank is full and your tires are in good shape. Always have extra water in the car.",
                cost: "$$$",
                isTopPick: false,
                isHiddenGem: false,
                isEveningOuting: false
            },
        ];
        
        let itinerary = [];

        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('locations-grid');
            const nav = document.getElementById('navigation');
            const navButtons = nav.querySelectorAll('.nav-btn');
            const itineraryList = document.getElementById('itinerary-list');
            const itineraryPlaceholder = document.getElementById('itinerary-placeholder');
            const toggleItineraryBtn = document.getElementById('toggle-itinerary');
            const itineraryContent = document.getElementById('itinerary-content');
            const itineraryArrow = document.getElementById('itinerary-arrow');
            const itineraryBuilder = document.getElementById('itinerary-builder');
            const copyBtn = document.getElementById('copy-itinerary-btn');
            const copyConfirmation = document.getElementById('copy-confirmation');
            const stickyItineraryBar = document.getElementById('sticky-itinerary-bar');
            const stickyItineraryText = document.getElementById('sticky-itinerary-text');
            const searchBar = document.getElementById('search-bar'); // NEW: Search bar element

            const parseTravelTime = (timeString) => {
                if (timeString.toLowerCase().includes("varies")) return Infinity;
                
                let totalMinutes = 0;
                const hourMatch = timeString.match(/(\d+)\s*hour/);
                const minMatch = timeString.match(/(\d+)\s*min/);

                if (hourMatch) {
                    totalMinutes += parseInt(hourMatch[1]) * 60;
                }
                if (minMatch) {
                    totalMinutes += parseInt(minMatch[1]);
                }
                return totalMinutes;
            };

            const renderLocations = (filter = 'all', searchTerm = '') => { // UPDATED: Accept search term
                grid.innerHTML = '';
                let filteredData = locationsData;
                
                // NEW: Search functionality
                if (searchTerm) {
                    filteredData = filteredData.filter(loc => 
                        loc.name.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                if (filter !== 'all') {
                    filteredData = filteredData.filter(loc => loc.tags.includes(filter));
                }
                
                filteredData.sort((a, b) => {
                    const timeA = parseTravelTime(a.travelTime);
                    const timeB = parseTravelTime(b.travelTime);

                    if(timeA === timeB){
                         return a.name.localeCompare(b.name);
                    }
                    return timeA - timeB;
                });

                if (filteredData.length === 0) {
                    grid.innerHTML = `<p class="text-center text-gray-500 md:col-span-2 lg:col-span-3">No locations match your search or filter.</p>`;
                    return;
                }

                filteredData.forEach(loc => {
                    const isInItinerary = itinerary.some(item => item.id === loc.id);
                    const buttonText = isInItinerary ? 'Added ‚úî' : 'Add to Itinerary +';
                    const buttonClasses = isInItinerary ? 'bg-green-500 text-white cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 text-white font-display';
                    
                    // UPDATED: All badge types
                    const topPickBadge = loc.isTopPick ? `<span class="absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-2xl shadow-md">‚≠ê Top Pick</span>` : '';
                    const hiddenGemBadge = loc.isHiddenGem ? `<span class="absolute top-0 right-0 bg-cyan-400 text-cyan-900 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-2xl shadow-md">üíé Hidden Gem</span>` : '';
                    const eveningOutingBadge = loc.isEveningOuting ? `<span class="absolute top-0 right-0 bg-indigo-400 text-indigo-900 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-2xl shadow-md">üåô Evening Outing</span>` : '';

                    const costDisplay = `<span class="text-sm font-bold px-2 py-1 rounded-md ${loc.cost === 'Free' ? 'bg-green-100 text-green-800' : 'bg-gray-200 text-gray-800'}">${loc.cost}</span>`;
                    const mapsLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name)}`;
                    
                    const card = `
                        <div class="location-card flex flex-col rounded-2xl shadow-sm overflow-hidden relative">
                             ${topPickBadge}
                             ${hiddenGemBadge}
                             ${eveningOutingBadge}
                            <div class="p-5 sm:p-6 bg-amber-50 border-b border-amber-200">
                                <h3 class="text-lg sm:text-xl font-bold text-gray-800 pr-4">
                                    <a href="${mapsLink}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600 transition-colors">${loc.name}</a>
                                </h3>
                                <div class="flex justify-between items-center mt-1">
                                    <p class="text-sm text-gray-500 font-medium">üöó ${loc.travelTime} <span class="font-bold">${loc.direction}</span></p>
                                    ${costDisplay}
                                </div>
                            </div>
                            <div class="p-5 sm:p-6 space-y-5 text-base text-gray-700 flex-grow">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl mt-0.5">ü§î</span>
                                    <div>
                                        <p class="font-semibold text-gray-800 text-sm">What it is</p>
                                        <p class="text-gray-600">${loc.whatItIs}</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl mt-0.5">üéØ</span>
                                    <div>
                                        <p class="font-semibold text-gray-800 text-sm">Perfect for</p>
                                        <p class="text-gray-600">${loc.perfectFor}</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl mt-0.5">üìã</span>
                                    <div>
                                        <p class="font-semibold text-gray-800 text-sm">Know before you go</p>
                                        <p class="text-gray-600">${loc.knowBeforeYouGo}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-auto p-5 sm:p-6 insider-tip border-t-2 border-dashed border-amber-400">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl mt-0.5">üí°</span>
                                    <div>
                                        <p class="font-bold text-amber-900 text-sm">Insider Tip</p>
                                        <p class="text-amber-800">${loc.insiderTip}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-gray-50 border-t">
                                <button data-id="${loc.id}" class="add-btn w-full px-4 py-2 font-bold rounded-lg ${buttonClasses}">${buttonText}</button>
                            </div>
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            };
            
            // NEW: Function to update URL with itinerary
            const updateURLHash = () => {
                if (itinerary.length > 0) {
                    const itineraryIds = itinerary.map(loc => loc.id).join(',');
                    window.location.hash = `#plan=${itineraryIds}`;
                } else {
                    // Removes hash from URL if history.pushState is supported, otherwise sets to empty
                    if (history.pushState) {
                        history.pushState("", document.title, window.location.pathname + window.location.search);
                    } else {
                        window.location.hash = '';
                    }
                }
            };

            // NEW: Function to read itinerary from URL on load
            const readURLHash = () => {
                const hash = window.location.hash;
                if (hash && hash.startsWith('#plan=')) {
                    const itineraryIds = hash.substring(6).split(',');
                    const loadedItinerary = itineraryIds.map(id => locationsData.find(loc => loc.id === id)).filter(Boolean); // filter(Boolean) removes any nulls if an ID is invalid
                    itinerary = loadedItinerary;
                    renderItinerary();
                }
            };


            const renderItinerary = () => {
                itineraryList.innerHTML = '';
                const count = itinerary.length;

                if (count === 0) {
                    itineraryPlaceholder.style.display = 'block';
                    copyBtn.disabled = true;
                } else {
                    itineraryPlaceholder.style.display = 'none';
                    copyBtn.disabled = false;
                    
                    itinerary.forEach((loc, index) => {
                        const item = document.createElement('div');
                        item.className = 'itinerary-item flex items-center justify-between p-3 rounded-lg shadow-sm';
                        item.setAttribute('draggable', true);
                        item.dataset.id = loc.id;
                        item.innerHTML = `
                            <div class="flex items-center gap-4">
                                <span class="drag-handle text-gray-400 cursor-grab touch-none text-xl">‚ò∞</span>
                                <div class="font-display font-bold text-gray-500 text-lg pr-2">${index + 1}.</div>
                                <div>
                                    <p class="font-bold text-gray-800">${loc.name}</p>
                                    <p class="text-sm text-gray-500">${loc.travelTime} ${loc.direction}</p>
                                </div>
                            </div>
                            <button data-id="${loc.id}" class="remove-btn text-red-500 hover:text-red-700 font-bold text-2xl pr-2">&times;</button>
                        `;
                        itineraryList.appendChild(item);
                    });
                }
                updateCardButtons();
                updateStickyItineraryBar();
                updateURLHash(); // NEW: Update URL whenever itinerary changes
            };

            const updateCardButtons = () => {
                const addButtons = document.querySelectorAll('.add-btn');
                addButtons.forEach(btn => {
                    const locationId = btn.dataset.id;
                    if (itinerary.some(item => item.id === locationId)) {
                        btn.textContent = 'Added ‚úî';
                        btn.disabled = true;
                        btn.className = 'add-btn w-full px-4 py-2 font-bold rounded-lg transition-colors bg-green-500 text-white cursor-not-allowed';
                    } else {
                        btn.textContent = 'Add to Itinerary +';
                        btn.disabled = false;
                        btn.className = 'add-btn w-full px-4 py-2 font-bold rounded-lg transition-colors bg-blue-500 hover:bg-blue-600 text-white font-display';
                    }
                });
            };

            const updateStickyItineraryBar = () => {
                const count = itinerary.length;
                const builderOffset = itineraryBuilder.offsetTop + itineraryBuilder.offsetHeight;
                
                if (count > 0 && window.scrollY > builderOffset) {
                    stickyItineraryText.textContent = `üìÖ View My Itinerary (${count}) - Click to Return to Top`;
                    stickyItineraryBar.classList.remove('-translate-y-full');
                    nav.style.top = `${stickyItineraryBar.offsetHeight}px`;
                } else {
                    stickyItineraryBar.classList.add('-translate-y-full');
                    nav.style.top = '1rem';
                }
            };
            
            stickyItineraryBar.addEventListener('click', () => {
                itineraryBuilder.scrollIntoView({ behavior: 'smooth' });
            });

            window.addEventListener('scroll', updateStickyItineraryBar);
            
            grid.addEventListener('click', e => {
                if (e.target.matches('.add-btn')) {
                    const locationId = e.target.dataset.id;
                    if (!itinerary.some(item => item.id === locationId)) {
                        const location = locationsData.find(loc => loc.id === locationId);
                        itinerary.push(location);
                        renderItinerary();
                    }
                }
            });

            itineraryList.addEventListener('click', e => {
                if (e.target.matches('.remove-btn')) {
                    const locationId = e.target.dataset.id;
                    itinerary = itinerary.filter(item => item.id !== locationId);
                    renderItinerary();
                }
            });

            toggleItineraryBtn.addEventListener('click', () => {
                itineraryContent.classList.toggle('open');
                itineraryArrow.classList.toggle('rotate-180');
            });
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && itinerary.length > 0) {
                        if (!itineraryContent.classList.contains('open')) {
                            itineraryContent.classList.add('open');
                            itineraryArrow.classList.add('rotate-180');
                        }
                    }
                });
            }, { threshold: 0.1 });

            observer.observe(itineraryBuilder);
            
            copyBtn.addEventListener('click', () => {
                let itineraryText = "My Joshua Tree Itinerary:\n\n";
                itinerary.forEach((loc, index) => {
                    itineraryText += `${index + 1}. ${loc.name} (${loc.travelTime} ${loc.direction})\n`;
                });

                // NEW: Add shareable link to copied text
                itineraryText += `\nShare this plan: ${window.location.href}`;

                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = itineraryText;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                
                copyConfirmation.style.opacity = '1';
                setTimeout(() => {
                    copyConfirmation.style.opacity = '0';
                }, 2000);
            });

            let draggedItem = null;

            itineraryList.addEventListener('dragstart', e => {
                draggedItem = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0);
            });

            itineraryList.addEventListener('dragend', e => {
                setTimeout(() => {
                    if (draggedItem) {
                        draggedItem.classList.remove('dragging');
                    }
                    draggedItem = null;
                }, 0);
            });
            
            itineraryList.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(itineraryList, e.clientY);
                const currentDragged = document.querySelector('.dragging');
                if (currentDragged) {
                    if (afterElement == null) {
                        itineraryList.appendChild(currentDragged);
                    } else {
                        itineraryList.insertBefore(currentDragged, afterElement);
                    }
                }
            });
            
            itineraryList.addEventListener('drop', e => {
                e.preventDefault();
                if(draggedItem){
                    const newOrderIds = [...itineraryList.querySelectorAll('.itinerary-item')].map(item => item.dataset.id);
                    itinerary.sort((a, b) => newOrderIds.indexOf(a.id) - newOrderIds.indexOf(b.id));
                    renderItinerary();
                }
            });
            
            itineraryList.addEventListener('touchstart', e => {
                if (e.target.classList.contains('drag-handle')) {
                    draggedItem = e.target.closest('.itinerary-item');
                    draggedItem.classList.add('touch-dragging');
                }
            }, {passive: false});

            itineraryList.addEventListener('touchmove', e => {
                if (!draggedItem) return;
                e.preventDefault();
                const touchLocation = e.targetTouches[0];
                const afterElement = getDragAfterElement(itineraryList, touchLocation.clientY);
                if (afterElement == null) {
                    itineraryList.appendChild(draggedItem);
                } else {
                    itineraryList.insertBefore(draggedItem, afterElement);
                }
            }, {passive: false});

            itineraryList.addEventListener('touchend', () => {
                if(!draggedItem) return;
                draggedItem.classList.remove('touch-dragging');
                const newOrderIds = [...itineraryList.querySelectorAll('.itinerary-item')].map(item => item.dataset.id);
                itinerary.sort((a, b) => newOrderIds.indexOf(a.id) - newOrderIds.indexOf(b.id));
                renderItinerary();
                draggedItem = null;
            });


            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.itinerary-item:not(.dragging):not(.touch-dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            nav.addEventListener('click', (e) => {
                if (e.target.matches('.nav-btn')) {
                    const filter = e.target.dataset.filter;
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    renderLocations(filter, searchBar.value);
                }
            });
            
            // NEW: Search bar event listener
            searchBar.addEventListener('input', () => {
                const activeFilter = document.querySelector('.nav-btn.active').dataset.filter;
                renderLocations(activeFilter, searchBar.value);
            });

            // --- INITIALIZATION ---
            readURLHash(); // Load itinerary from URL first
            renderLocations('all'); // Then render all locations
            if (itinerary.length > 0) {
                 renderItinerary(); // Re-render itinerary to ensure consistency if loaded from URL
            } else {
                 renderItinerary(); // Standard initial render if no URL hash
            }
        });
    </script>
</body>
</html>


